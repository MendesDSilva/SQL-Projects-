CREATE DATABASE OFICINA_SEU_JOSE;

	USE OFICINA_SEU_JOSE;

CREATE TABLE CLIENTES
(

	IDCLIENTE INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(50) NOT NULL,
	CPF VARCHAR(15) NOT NULL,
	EMAIL VARCHAR(50) NOT NULL,
	SEXO ENUM('M','F'),
	ID_CARROS INT UNIQUE	

);

CREATE TABLE TELEFONE
(

	IDTELEFONE INT PRIMARY KEY AUTO_INCREMENT,
    TIPO ENUM('RES','CEL','COM') NOT NULL,
    NUMERO VARCHAR(30),
    ID_CLIENTES INT
);

CREATE TABLE CARROS
(

	IDCARROS INT PRIMARY KEY AUTO_INCREMENT,
	PLACA VARCHAR(15) UNIQUE,
	MODELO VARCHAR(30) NOT NULL,
	ID_MARCAS INT


);

CREATE TABLE MARCAS 
(

	IDMARCAS INT PRIMARY KEY AUTO_INCREMENT,
	MARCAS VARCHAR(30) UNIQUE	


);

CREATE TABLE CORES 
(

	IDCORES INT PRIMARY KEY AUTO_INCREMENT,
	COR VARCHAR(10) UNIQUE

);

CREATE TABLE CARRO_COR(
	ID_CARROS INT,
	ID_CORES INT,
	PRIMARY KEY(ID_CARROS,ID_CORES)
);



/* CRIANDO CONSTRAINTS */

ALTER TABLE CLIENTES
ADD CONSTRAINT FK_CARROS_CLIENTES
FOREIGN KEY(ID_CARROS)
REFERENCES CARROS (IDCARROS);


ALTER TABLE TELEFONE
ADD CONSTRAINT FK_CLIENTES_TELEFONE
FOREIGN KEY (ID_CLIENTES)
REFERENCES CLIENTES(IDCLIENTE);

ALTER TABLE CARROS
ADD CONSTRAINT FK_MARCAS_CARROS
FOREIGN KEY (ID_MARCAS)
REFERENCES CARROS (IDCARROS);

ALTER TABLE CARRO_COR
ADD CONSTRAINT FK_CORES
FOREIGN KEY (ID_CORES)
REFERENCES CORES(IDCORES);

ALTER TABLE CARRO_COR
ADD CONSTRAINT FK_CARROS
FOREIGN KEY (ID_CARROS)
REFERENCES CARRO(IDCARROS);



==---------------------------------==
/* RELATORIO GERAL DOS CLIENTES */
==---------------------------------==

SELECT CLIENTE.IDCLIENTE, CLIENTE.NOME, CLIENTE.SEXO, CLIENTE.EMAIL, CLIENTE.CPF,
       ENDERECO.RUA, ENDERECO.BAIRRO
FROM CLIENTE
INNER JOIN ENDERECO 
ON CLIENTE.IDCLIENTE = ENDERECO.ID_CLIENTE;

==------------------------------------------==
/* VIEW PARA CHAMAR RELATORIO GERAL CLIENTE */
==------------------------------------------==


CREATE VIEW CHAMA_CLIENTES AS 

SELECT 
  
   CLIENTE.IDCLIENTE, CLIENTE.NOME, CLIENTE.SEXO, CLIENTE.EMAIL, CLIENTE.CPF, 
   TELEFONE.NUMERO,ENDERECO.RUA, ENDERECO.BAIRRO

FROM CLIENTE
INNER JOIN TELEFONE
ON CLIENTE.IDCLIENTE = TELEFONE.ID_CLIENTE
INNER JOIN ENDERECO
ON CLIENTE.IDCLIENTE = ENDERECO.ID_CLIENTE ; 



/*                                                                         /*
SR. JOSÉ QUER MODERNIZAR A SUA OFICINA, E POR ENQUANTO, CADASTRAR OS CARROS 
QUE ENTRAM PARA REALIZAR SERVIÇOS E OS SEUS RESPECTIVOS DONOS. SR. JOSÉ MENS-
IONOU QUE CADA CLIENTE POSSUI APENAS UM CARRO.UM CARRO POSSUI UMA MARCA.
SR.JOSÉ TAMBÉM QUER SABER AS CORES DOS CARROS PARA TER IDÉIA DE QUAL TINTA
COMPRAR, E INFORMA QUE UM CARRO PODE TER MAIS DE UMA COR. SR.JOSÉ NECESSITA
ARMAZENAR OS TELEFONES DOS CLIENTE, MAS NÃO QUER QUE ELES SEJAM OBRIGATÓRIOS.
*/                                                                          /*

/* LEMBRANDO QUE EM UM RELACIONAMENTO 1 X 1 A CHAVE ESTRANGEIRA FICA NA MAIS FRACA.
   NESTE CASO A BASE DE CLIENTES É MAIS FRACA QUE AS DOS CARRORS, POIS O QUE É IMPORTANTE
   SÃO OS CARROS, OS CLIENTES SÓ ACOMPANHAM.
*/


CREATE DATABASE OFICINA_JOSE;

USE OFICINA_JOSE;

CREATE TABLE CARROS(

	IDCARROS INT PRIMARY KEY AUTO_INCREMENT,
	PLACA VARCHAR(30) NOT NULL UNIQUE,
	ID_MARCA INT,
	MODELO VARCHAR(30) NOT NULL
);

CREATE TABLE MARCA(

	IDMARCA INT PRIMARY KEY AUTO_INCREMENT,
	MARCA VARCHAR(30) NOT NULL UNIQUE

);

CREATE TABLE CORES(

	IDCORES INT PRIMARY KEY AUTO_INCREMENT,
	CORES VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE CLIENTES(

	IDCLIENTES INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30) NOT NULL,
	SEXO ENUM('M','F') NOT NULL,
	CPF VARCHAR(30) NOT NULL,
    ID_CARROS INT UNIQUE
);

CREATE TABLE ENDERECO(

	IDENDERECO INT PRIMARY KEY AUTO_INCREMENT,
	RUA VARCHAR(30) NOT NULL,
	BAIRRO VARCHAR(30) NOT NULL,
	CIDADE VARCHAR(30) NOT NULL,
	ESTADO CHAR(2) NOT NULL,
	ID_CLIENTES INT
);

CREATE TABLE TELEFONE(

	IDTELEFONE INT PRIMARY KEY AUTO_INCREMENT,
	TIPO ENUM('COM','CEL','RES') NOT NULL,
	NUMERO VARCHAR(30) NOT NULL,
	ID_CLIENTES INT
);

CREATE TABLE CARRO_COR(
	ID_CARROS INT,
	ID_CORES INT,
	PRIMARY KEY(ID_CARROS,ID_CORES)
);


--=========================================================--
       /* CRIAÇÃO DE CONSTRAINTS CHAVES ESTRANGEIRAS */
--=========================================================--


/* ADICIONA CHAVE ESTRANGEIRA À TABELA CLIENTES FK_CLIENTES_CARRO */

ALTER TABLE CLIENTES
ADD CONSTRAINT FK_CLIENTES_CARRO
FOREIGN KEY (ID_CARROS)
REFERENCES CARROS (IDCARROS);

/* ADICIONA CHAVE ESTRANGEIRA À TABELA ENDERECO FK_ENDERECO_CLIENTES */

ALTER TABLE ENDERECO
ADD CONSTRAINT FK_CLIENTES_ENDERECO
FOREIGN KEY (ID_CLIENTES)
REFERENCES CLIENTES (IDCLIENTES);


/* ADICIONA CHAVE ESTRANGEIRA À TABELA TELEFONE FK_TELEFONE_CLIENTES */

ALTER TABLE TELEFONE
ADD CONSTRAINT FK_CLIENTE_TELEFONE
FOREIGN KEY (ID_CLIENTES)
REFERENCES CLIENTES (IDCLIENTES);

/* ADICIONA CHAVE ESTRANGEIRA À TABELA CARROS FK_CARROS_MARCA */

ALTER TABLE CARROS
ADD CONSTRAINT FK_MARCA_CARROS
FOREIGN KEY (ID_MARCA)
REFERENCES MARCA (IDMARCA);

/* ADICIONA CHAVE ESTRANGEIRA À TABELA CARROS FK_CARROS_COR */

ALTER TABLE CARRO_COR
ADD CONSTRAINT FK_CORES
FOREIGN KEY (ID_CORES)
REFERENCES CORES(IDCORES);


/* ADICIONA CHAVE ESTRANGEIRA À TABELA CARROS FK_COR_CARROS */

ALTER TABLE CARRO_COR
ADD CONSTRAINT FK_CARROS
FOREIGN KEY (ID_CARROS)
REFERENCES CARROS(IDCARROS);

